#LAB9:DARKHOLE 1
```
https://www.vulnhub.com/entry/darkhole-1,724/
```
## Chuẩn bị
* Kali Linux: 10.3.0.165

![image](https://user-images.githubusercontent.com/92532460/224473879-0a5eadb8-cb89-44d6-a90e-d56535a139ec.png)

* Máy victim: Darkhole1

![image](https://user-images.githubusercontent.com/92532460/224473916-7973ba1b-46d1-4099-913c-691885815365.png)
## Xác định mục tiêu
* Bước đầu tiên là chạy lệnh Netdetect để xác định địa chỉ IP của máy mục tiêu. Trong ảnh chụp màn hình bên dưới, Netdetect đã cung cấp cho chúng tôi danh sách tất cả các địa chỉ IP khả dụng. Nó có thể được nhìn thấy trong ảnh chụp màn hình sau đây
```
netdiscover -i eth0 -r 10.3.0.0/24
```
![image](https://user-images.githubusercontent.com/92532460/224474010-e8ac90b3-f3f6-4449-8994-ae37c12dbcdf.png)

* Xác định được máy mục tiêu có IP là 10.3.0.182
* Bước thứ hai là chạy quét cổng để xác định các cổng và dịch vụ đang mở trên máy mục tiêu
```
nmap -sC -sV 10.3.0.182  
```

![image](https://user-images.githubusercontent.com/92532460/224474133-fd76c009-237e-4aab-9c5a-c5642fcde3b5.png)
 
* Đầu ra của Nmap cho thấy hai cổng mở đã được xác định là Mở trong quá trình quét toàn bộ cổng. Cổng 80 đang được sử dụng cho dịch vụ HTTP và cổng 22 đang được sử dụng cho dịch vụ SSH.

* Trong bước tiếp theo, chúng tôi sẽ bắt đầu CTF với Cổng 80.
## Khai thác
* Bước 3 Hãy bắt đầu CTF bằng cách khám phá cổng HTTP. Chúng tôi đã mở địa chỉ IP của máy mục tiêu trên trình duyệt.

![image](https://user-images.githubusercontent.com/92532460/224474669-621ff4c0-6281-4996-a7fe-f8c8c26f64e8.png)

* Trong ảnh chụp màn hình ở trên, chúng ta có thể thấy ứng dụng đích. Có một chức năng đăng nhập, vì vậy hãy chuyển đến trang đăng nhập. Trang đăng nhập có thể được nhìn thấy dưới đây.

![image](https://user-images.githubusercontent.com/92532460/224474715-2a1e9e0e-44a8-4a92-96e8-90e404007370.png)

* Ở đây, chúng tôi có chức năng đăng nhập cũng như đăng ký. Vì vậy, chúng tôi đã nhấp vào 'đăng ký' để đăng ký làm người dùng mới trên ứng dụng mục tiêu.

![image](https://user-images.githubusercontent.com/92532460/224474888-5d9f5762-9bda-4af0-a876-a2c2a5202159.png)
* Chúng tôi đã đăng ký với tư cách là người dùng mới trên máy mục tiêu và yêu cầu với các chi tiết được cung cấp có thể được nhìn thấy ở trên bị chặn trong cửa sổ BurpSuite. Hãy sử dụng những chi tiết này để đăng nhập vào ứng dụng mục tiêu.

![image](https://user-images.githubusercontent.com/92532460/224549700-920d3e89-9d98-4cb2-b68c-50aacb7dbff2.png)

* Có chức năng thay đổi mật khẩu cho người dùng hiện tại với lỗi quản lý phiên. Chúng tôi đã chặn yêu cầu thay đổi mật khẩu trong burp và thấy rằng thay đổi mật khẩu phụ thuộc vào tham số id.

![image](https://user-images.githubusercontent.com/92532460/224550144-fc94b52a-a630-4084-8588-a6e6fb5811a6.png)

* Chúng tôi đã thay đổi giá trị id người dùng hiện tại từ 3 thành id của người dùng quản trị viên, tức là 1. Thông qua đó, chúng tôi có thể thay đổi mật khẩu cho quản trị viên người dùng. Sau đó, chúng tôi đã đăng nhập vào ứng dụng đích với tư cách là quản trị viên người dùng. Chúng tôi bắt đầu khám phá thêm chức năng thông qua người dùng quản trị.

![image](https://user-images.githubusercontent.com/92532460/224550228-8976e3ca-83c7-46b0-963f-874ce0b2fedf.png)

* Chúng tôi đã tìm thấy chức năng tải tệp lên trong ứng dụng mục tiêu. Nó dễ bị tải lên tệp độc hại. Chúng tôi có thể tải lên trình bao PHP thông qua điều này và có quyền truy cập vào máy mục tiêu.
![image](https://user-images.githubusercontent.com/92532460/224550321-81b64b17-84d8-4ce9-8881-c783ff68e69d.png)

![image](https://user-images.githubusercontent.com/92532460/224491232-5c6b33c9-9610-41a7-990f-554a467044e6.png)

* Bước 4 Trên máy kẻ tấn công của chúng tôi, chúng tôi đã tạo một tải trọng ở dạng trình bao PHP để lấy trình bao đảo ngược từ máy mục tiêu.
 ![image](https://user-images.githubusercontent.com/92532460/224550532-975ccac0-3915-4007-88cd-7949a6d96350.png)
* Quá trình tải lên không thành công vì ứng dụng đích không chấp nhận phần mở rộng tệp 'PHP. Vì vậy, trong phần yêu cầu, chúng tôi đã thay đổi phần mở rộng tệp thành 'phar.'
![image](https://user-images.githubusercontent.com/92532460/224550822-a4815e47-72c0-417d-b95c-031ebcf4565c.png)
* Sau đó, chúng tôi đã gửi yêu cầu và lần này. Ứng dụng mục tiêu không trả lại lỗi. Điều này có nghĩa là tệp đã được tải lên thành công. Tiếp theo, chúng tôi sẽ mở tải trọng đã tải lên 'shell.phar' trên trình duyệt.

